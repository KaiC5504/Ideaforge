# IdeaForge - Architecture Documentation

This document explains the project structure and what each file does.

---

## Project Structure (Current)

```
ideaforge/
├── src/
│   ├── app/
│   │   ├── layout.tsx      # Root layout with HTML structure
│   │   ├── page.tsx        # Homepage component
│   │   ├── globals.css     # Tailwind CSS directives
│   │   └── api/
│   │       └── ideas/
│   │           ├── route.ts        # GET /api/ideas, POST /api/ideas
│   │           └── [id]/
│   │               └── route.ts    # GET /api/ideas/[id]
│   └── lib/
│       └── db.ts           # Prisma client with adapter pattern
├── prisma/
│   ├── schema.prisma       # Database schema (6 models)
│   └── migrations/         # Migration history
│       └── 20260102.../    # Initial migration
├── memory-bank/
│   ├── architecture.md     # This file - architecture docs
│   ├── progress.md         # Development progress tracker
│   ├── Implementation.md   # Step-by-step implementation guide
│   ├── tech-stack.md       # Technology decisions
│   └── web-design-document.md  # Product specification
├── .next/                  # Next.js build output (gitignored)
│   └── standalone/         # Self-contained production build
│       └── server.js       # Production server entry point
├── node_modules/           # Dependencies (gitignored)
├── package.json            # Project dependencies & scripts
├── tsconfig.json           # TypeScript configuration
├── tailwind.config.ts      # Tailwind CSS configuration
├── postcss.config.mjs      # PostCSS plugins config
├── next.config.ts          # Next.js configuration
├── prisma.config.ts        # Prisma configuration (env loading)
├── .env                    # Environment variables (gitignored)
├── .env.example            # Environment template
├── .eslintrc.json          # ESLint configuration
├── .gitignore              # Git ignore rules
└── CLAUDE.md               # AI assistant instructions
```

---

## File Explanations

### Configuration Files

**package.json**
- Defines project name as `ideaforge` (lowercase for npm compatibility)
- Contains npm scripts: `dev`, `build`, `start`, `lint`
- Lists all runtime and development dependencies
- Version: 0.1.0

**tsconfig.json**
- TypeScript compiler configuration
- `strict: true` - Enables all strict type checking
- `moduleResolution: bundler` - For Next.js bundler
- `jsx: react-jsx` - React 17+ JSX transform
- Path alias: `@/*` maps to `./src/*`

**next.config.ts**
- `output: 'standalone'` - Creates self-contained production build
- This is critical for single-server deployment without node_modules

**tailwind.config.ts**
- Configures Tailwind CSS content paths
- Scans `src/pages/**`, `src/components/**`, `src/app/**`
- Extensible theme configuration (currently empty)

**postcss.config.mjs**
- Uses `@tailwindcss/postcss` plugin (Tailwind v4 requirement)
- Includes `autoprefixer` for CSS vendor prefixes

**.eslintrc.json**
- Extends `next/core-web-vitals` for Next.js best practices
- Enforces React hooks rules and accessibility

**.gitignore**
- Excludes `node_modules/`, `.next/`, `.env` files
- Protects secrets and build artifacts from version control

**prisma.config.ts**
- Prisma 7 configuration file
- Imports `dotenv/config` to load environment variables
- Points to schema and migrations directories
- Configures datasource URL from `DATABASE_URL`

**.env / .env.example**
- `.env` contains actual database credentials (gitignored)
- `.env.example` is a template for other developers
- Required variable: `DATABASE_URL` (PostgreSQL connection string)

### Database Files

**prisma/schema.prisma**
- Defines all 6 database models using Prisma schema language
- Uses `prisma-client-js` generator for compatibility
- All relations use `onDelete: Cascade` for data integrity
- Indexes on `ideaId` columns for query performance

**prisma/migrations/**
- Contains SQL migration files generated by Prisma
- Each migration is timestamped and named
- Applied with `npx prisma migrate dev` (development) or `npx prisma migrate deploy` (production)

**src/lib/db.ts**
- Singleton Prisma client instance using adapter pattern (Prisma 7)
- Uses `@prisma/adapter-pg` with `pg` Pool for PostgreSQL connection
- Uses global caching to prevent multiple connections during hot reload
- Exports `db` for importing in API routes and server components
- Loads connection string from `DATABASE_URL` environment variable

### API Routes (Implemented)

**src/app/api/ideas/route.ts**
- `POST /api/ideas` - Create new idea with originalIdea and enhancedIdea
- `GET /api/ideas` - List all ideas (newest first, basic fields only)
- Uses Zod for request body validation
- Returns JSON with `success` flag and `data` or `error`

**src/app/api/ideas/[id]/route.ts**
- `GET /api/ideas/:id` - Retrieve complete idea with all relations
- Includes: scores, improvements, features, techStack, kanbanTickets
- Returns 404 if idea not found

### Source Files

**src/app/layout.tsx**
- Root layout component (required by App Router)
- Sets HTML `<html>` and `<body>` structure
- Defines page metadata: title "IdeaForge - Project Idea Incubator"
- Imports global CSS styles
- Wraps all pages with consistent structure

**src/app/page.tsx**
- Homepage component
- Currently displays "Welcome to IdeaForge" placeholder
- Will be replaced with ideas dashboard in Phase 5

**src/app/globals.css**
- Contains Tailwind CSS directives: `@tailwind base/components/utilities`
- Entry point for all Tailwind styles
- Can add custom global styles here

---

## Planned Structure (After All Phases)

```
ideaforge/
├── src/
│   ├── app/
│   │   ├── layout.tsx              # Root layout
│   │   ├── page.tsx                # Dashboard (ideas list)
│   │   ├── globals.css             # Global styles
│   │   ├── ideas/
│   │   │   └── [id]/
│   │   │       └── page.tsx        # Idea detail page
│   │   └── api/
│   │       ├── ideas/
│   │       │   ├── route.ts        # GET /api/ideas, POST /api/ideas
│   │       │   └── [id]/
│   │       │       ├── route.ts    # GET /api/ideas/[id]
│   │       │       ├── scores/route.ts
│   │       │       ├── improvements/route.ts
│   │       │       ├── features/route.ts
│   │       │       ├── techstack/route.ts
│   │       │       ├── userflow/route.ts
│   │       │       └── kanban/
│   │       │           ├── route.ts
│   │       │           └── [ticketId]/route.ts
│   ├── components/
│   │   ├── IdeaComparison.tsx      # Original vs Enhanced display
│   │   ├── ScoreDisplay.tsx        # 6-dimension score bars
│   │   ├── ImprovementsDisplay.tsx # Strategic improvements
│   │   ├── FeaturesList.tsx        # Features by priority
│   │   ├── TechStackDisplay.tsx    # Tech recommendations
│   │   ├── UserFlowDiagram.tsx     # React Flow diagram
│   │   └── KanbanBoard.tsx         # Drag-drop task board
│   └── lib/
│       └── db.ts                   # Prisma client singleton
├── prisma/
│   ├── schema.prisma               # Database schema
│   └── migrations/                 # Migration history
├── deployment/
│   ├── ideaforge.service           # Systemd service file
│   ├── Caddyfile                   # Caddy reverse proxy config
│   ├── deploy.sh                   # Deployment script
│   └── init-database.sh            # Database initialization
└── [config files...]
```

---

## Database Schema (Implemented)

```
Idea (1) ──────┬──> Score (many)
               ├──> Improvement (many)
               ├──> Feature (many)
               ├──> TechStack (many)
               ├──> KanbanTicket (many)
               └──> userFlow (Json field)
```

All related models cascade on delete from Idea.

### Model Details

| Model | Fields | Notes |
|-------|--------|-------|
| **Idea** | id, originalIdea, enhancedIdea, createdAt, userFlow | Core entity, has all relations |
| **Score** | id, ideaId, dimension, score, justification | 6 dimensions rated 1-10 |
| **Improvement** | id, ideaId, dimension, suggestion | Linked to weak scoring areas |
| **Feature** | id, ideaId, name, description, priority | Priority: must-have/should-have/nice-to-have |
| **TechStack** | id, ideaId, category, technology, justification | Grouped by category |
| **KanbanTicket** | id, ideaId, title, description, status, effort | Status: backlog/todo/in-progress/in-review/done |

### Database Connection

- **Local Development:** PostgreSQL 18 on localhost:5432
- **Database Name:** ideaforge
- **User:** ideaforge (with CREATEDB permission)
- **Connection:** Via `DATABASE_URL` in `.env`

---

## Key Architectural Decisions

1. **Single-Server Deployment**
   - No managed services (Vercel, Supabase, etc.)
   - PostgreSQL runs locally on same server
   - Caddy handles HTTPS automatically
   - systemd manages the Node.js process

2. **Standalone Build**
   - `output: 'standalone'` in next.config.ts
   - Creates `.next/standalone/server.js`
   - Includes minimal node_modules
   - Run with: `node .next/standalone/server.js`

3. **App Router (not Pages Router)**
   - Modern Next.js routing in `src/app/`
   - Server Components by default
   - `"use client"` directive for client components

4. **Tailwind v4 with PostCSS**
   - Uses `@tailwindcss/postcss` plugin
   - Not the older direct tailwindcss plugin
   - Works with Next.js 16 Turbopack

5. **Client-Side Visualizations**
   - Recharts, React Flow, @dnd-kit run in browser
   - No server cost for rendering
   - Interactive and responsive

6. **Prisma 7 Adapter Pattern**
   - Prisma 7 removed `url` from schema.prisma datasource
   - Uses `@prisma/adapter-pg` with native `pg` Pool driver
   - CLI tools (migrations) configured via `prisma.config.ts`
   - Runtime connection configured in `src/lib/db.ts` with adapter

7. **API Response Format**
   - All endpoints return JSON with consistent structure
   - Success: `{ success: true, data: ... }`
   - Error: `{ success: false, error: "message" }`
   - Validation errors include field-level details

---

## Environment Variables

| Variable | Description | Example |
|----------|-------------|---------|
| DATABASE_URL | PostgreSQL connection | postgresql://user:pass@localhost/ideaforge |
| NODE_ENV | Environment mode | production |

---

**Last Updated:** 2026-01-02 (Phase 3 - API routes added)
